# Release Instructions

Instructions for releasing a new version of these libraries to Hackage.

Note that the test/benchmark/tutorial packages should **not** be uploaded to Hackage,
since they are intended only for use within this repository:

- `proto-lens-benchmarks`
- `proto-lens-tests`
- `proto-lens-tests-dep`
- `proto-lens-tutorial/*`

## Prerequisites
- Make sure that the descriptors have been bootstrapped by running `runghc bootstrap.hs`.
- Make sure that each package's version number has been bumped and conforms to the PVP.
- Make sure each package's `Changelog.md` file is up-to-date.
- Make sure you are on a commit that has been merged upstream to `google/proto-lens`.

## Steps
1. For each package *without* autogenerated proto modules, simply run (from the root of the repo):

        stack upload {name-of-package}

  Then verify that they've been uploaded successfully by visiting `hackage.org` in a web browser.

2. For packages *with* autogenerated proto-modules (currently:
`proto-lens-protobuf-types` and `proto-lens-combinators`): these are a little
harder to upload due to #185.  We have a script for running `sdist`:

        ./release.sh

  Then, for each package that should be uploaded:

        cabal upload {package}/dist/{path}.tar.gz

3. Finally, tag each uploaded package with its version and push it back to upstream.  For example:

        git tag -a proto-lens-v0.3.0.0 -m "Release proto-lens v0.3.0.0"
        ...
        git remote add upstream git@github.com:google/proto-lens.git
        git push upstream --follow-tags  # See: https://stackoverflow.com/a/26438076
    
